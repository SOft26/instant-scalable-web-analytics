apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-plausible-to-databases
  namespace: plausible
spec:
  podSelector: {}   # applies to all pods in this namespace
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: plausible
    ports:
    - protocol: TCP
      port: 5432   # PostgreSQL
    - protocol: TCP
      port: 8123   # ClickHouse
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: postgres
    ports:
    - protocol: TCP
      port: 5432
  - to:
    - podSelector:
        matchLabels:
          app: clickhouse
    ports:
    - protocol: TCP
      port: 8123

